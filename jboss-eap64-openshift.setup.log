# Using the docs:
# https://access.redhat.com/documentation/en/red-hat-xpaas/version-0/red-hat-xpaas-eap-image/#getting_started

[root@x18tclddkr2a ipe]# oc get is -n openshift   # Notice the tags are missing for the xPaaS img streams 
NAME                                  DOCKER REPO                                                                    TAGS                      UPDATED
fis-java-openshift                    registry.access.redhat.com/jboss-fuse-6/fis-java-openshift   
fis-karaf-openshift                   registry.access.redhat.com/jboss-fuse-6/fis-karaf-openshift  
jboss-amq-62                          registry.access.redhat.com/jboss-amq-6/amq62-openshift       
jboss-datagrid65-openshift            registry.access.redhat.com/jboss-datagrid-6/datagrid65-openshift
jboss-decisionserver62-openshift      registry.access.redhat.com/jboss-decisionserver-6/decisionserver62-openshift
jboss-eap64-openshift                 registry.access.redhat.com/jboss-eap-6/eap64-openshift       
jboss-eap70-openshift                 registry.access.redhat.com/jboss-eap-7/eap70-openshift       
jboss-webserver30-tomcat7-openshift   registry.access.redhat.com/jboss-webserver-3/webserver30-tomcat7-openshift
jboss-webserver30-tomcat8-openshift   registry.access.redhat.com/jboss-webserver-3/webserver30-tomcat8-openshift
jenkins                               172.30.6.239:5000/openshift/jenkins                                            1
mariadb                               172.30.6.239:5000/openshift/mariadb                                            10.1
mongodb                               172.30.6.239:5000/openshift/mongodb                                            2.4,2.6,3.2
mysql                                 172.30.6.239:5000/openshift/mysql                                              5.5,5.6
nodejs                                172.30.6.239:5000/openshift/nodejs                                             0.10,4
perl                                  172.30.6.239:5000/openshift/perl                                               5.16,5.20
php                                   172.30.6.239:5000/openshift/php                                                5.5,5.6                   13 days ago
postgresql                            172.30.6.239:5000/openshift/postgresql                                         9.2,9.4,9.5
python                                172.30.6.239:5000/openshift/python                                             2.7,3.3,3.4 + 1 more...
redhat-sso70-openshift                172.30.6.239:5000/openshift/redhat-sso70-openshift                             1.3-TP
ruby                                  172.30.6.239:5000/openshift/ruby                                               2.3,2.0,2.2
[root@x18tclddkr2a ipe]# oc get istag -n openshift
NAME      DOCKER REF                                                                                                UPDATED       IMAGENAME
php:5.5   172.30.6.239:5000/openshift/php@sha256:3a2f443d167bab5ea57e76de6821d18b7777f55d242ea565f1294b9a13a0d44d   13 days ago   sha256:3a2f443d167bab5ea57e76de6821d18b7777f55d242ea565f1294b9a13a0d44d
[root@x18tclddkr2a ipe]#

# Following the steps in EAP documentation 

[root@x18tclddkr2a eap-openshift]# oc create sa eap-service-account
serviceaccount "eap-service-account" created
[root@x18tclddkr2a eap-openshift]# oc get sa
NAME                  SECRETS   AGE
builder               2         15d
default               2         15d
deployer              2         15d
eap-service-account   2         4s

[root@x18tclddkr2a eap-openshift]# oc policy add-role-to-user view system:serviceaccount:$(oc project -q):eap-service-account

[root@x18tclddkr2a eap-openshift]# echo oc policy add-role-to-user view system:serviceaccount:$(oc project -q):eap-service-account
oc policy add-role-to-user view system:serviceaccount:ibgt-ipe:eap-service-account

[root@x18tclddkr2a eap-openshift]# oc project -q
ibgt-ipe


[root@x18tclddkr2a eap-openshift]# oc get secret
NAME                                  TYPE                                  DATA      AGE
builder-dockercfg-aza38               kubernetes.io/dockercfg               1         15d
builder-token-28jo4                   kubernetes.io/service-account-token   3         15d
builder-token-ath2i                   kubernetes.io/service-account-token   3         15d
default-dockercfg-dtby1               kubernetes.io/dockercfg               1         15d
default-token-swxuq                   kubernetes.io/service-account-token   3         15d
default-token-u1n3p                   kubernetes.io/service-account-token   3         15d
deployer-dockercfg-lal1z              kubernetes.io/dockercfg               1         15d
deployer-token-bgtg8                  kubernetes.io/service-account-token   3         15d
deployer-token-xgj1x                  kubernetes.io/service-account-token   3         15d
eap-service-account-dockercfg-wsjxm   kubernetes.io/dockercfg               1         5m
eap-service-account-token-qc2dy       kubernetes.io/service-account-token   3         5m
eap-service-account-token-tk8r1       kubernetes.io/service-account-token   3         5m
[root@x18tclddkr2a eap-openshift]# #oc secret new
[root@x18tclddkr2a eap-openshift]# pwd
/ipe/eap-openshift

[root@x18tclddkr2a eap-openshift]# oc get bc
NAME       TYPE      FROM      LATEST
ipe-vasg   Docker    Binary    0

[root@x18tclddkr2a eap-openshift]# oc secret new ipe-vasg-secret
modules/           standalone/        x01sparsapp1a.jks

[root@x18tclddkr2a eap-openshift]# oc secret new ipe-vasg-secret x01sparsapp1a.jks
secret/ipe-vasg-secret

[root@x18tclddkr2a eap-openshift]# oc secrets add serviceaccount/eap-service-account secret/ipe-vasg-secret

# Create a binary build config 

[root@x18tclddkr2a eap-openshift]# oc new-build --name=ipe-vasg --image-stream=jboss-eap64-openshift --binary=true --allow-missing-imagestream-tags
--> Found tag :latest in image stream "jboss-eap64-openshift" in project "openshift" for "jboss-eap64-openshift"

    * A Docker build using binary input will be created
      * The resulting image will be pushed to image stream "ipe-vasg:latest"

--> Creating resources with label build=ipe-vasg ...
    imagestream "ipe-vasg" created
    buildconfig "ipe-vasg" created
--> Success

# Start the build 

[root@x18tclddkr2a eap-openshift]# oc start-build ipe-vasg --from-dir=. --follow                
Uploading "." at commit "HEAD" as binary input for the build ...
Uploading directory "." as binary input for the build ...
Error from server: imagestreamtags "jboss-eap64-openshift:eap" not found
[root@x18tclddkr2a eap-openshift]# 


OTHER commands:

root@x18tclddkr2a eap-openshift]# oc new-build --name=ipe-vasg --image-stream=jboss-eap64-openshift-imagestream-tags
--> Found tag :eap in image stream "jboss-eap64-openshift" in project "openshift" for "jboss-eap64-o

    * A Docker build using binary input will be created
      * The resulting image will be pushed to image stream "ipe-vasg:latest"

--> Creating resources with label build=ipe-vasg ...
    error: imagestreams "ipe-vasg" already exists
    buildconfig "ipe-vasg" created


# We see an EAP image in their "UAT" registry and want to try and pull it and push it into OCP.... 
# But we see a Docker pull error (tag missing?) 

[root@x18tclddkr2a ipe]# docker pull x18scldrepo2a.cld.uat.dbs.com:5000/jboss-eap-6/eap64-openshift Using default tag: latest
Trying to pull repository x18scldrepo2a.cld.uat.dbs.com:5000/jboss-eap-6/eap64-openshift ... latest: Pulling from jboss-eap-6/eap64-openshift
 
f780b4676575: Download complete
c0cbeb76fae2: Download complete
5af97c8b7253: Download complete
83aba161914a: Download complete
c44c17fedec0: Download complete
not found
Error: image jboss-eap-6/eap64-openshift:latest not found
[root@x18tclddkr2a ipe]#

